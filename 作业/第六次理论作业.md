1. ⽂件系统的性能对整体系统的性能影响很⼤，请总结在实现⽂件系统时可以从哪些⽅⾯提⾼⽂件系统的性能，简要给出这些⼿段的具体解决思路。**

   1. 设计文件系统时应尽量减少访问磁盘的次数以提高文件系统的性能，措施包括使用块高速缓存和目录项分解法等等。使用更大的块高速缓存能直接减少对磁盘的访问次数，提升文件系统读写性能；而项目录分解法把目录项（文件控制块）分为两部分：名号目录项，包含文件名以及相应的文件内部号；基本目录项，包含了除文件名外文件控制块的其他全部信息。目录文件也分为名号目录文件和基本目录文件。查找一个目录项就分成两步：首先访问名号目录文件，根据文件名查找相应的文件内部号；然后访问基本目录文件，根据文件内部号，可直接计算出相应基本目录项所在基本目录文件中的相对位置和物理位置，并将它直接读入内存，提高了文件目录检索的速度。
   2. 改善磁盘性能，包括采用磁盘驱动调度改善进程对磁盘的平均访问时间，采用磁盘碎片整理技术等等。当多个访盘请求在等待时，系统采用一定的策略，对这些请求的服务顺序进行调整安排，使寻道时间和延迟时间都尽可能小的那个访问请求可以优先得到服务，并降低若干个访问者的总访问时间，增加磁盘单位时间内的操作次数。达到降低平均磁盘服务时间的目的，从而实现公平、高效的访盘请求。磁盘碎片的产生是因为文件被分散保存到整个磁盘的不同地方，而不是连续地保存在磁盘连续的簇中形成的。文件碎片一般不会在系统中引起问题，但文件碎片过多会使系统在读文件的时候来回寻找，引起系统性能下降，严重的还要缩短硬盘寿命。磁盘碎片整理技术对长期运行产生的磁盘碎片进行整合，可提高磁盘的整体性能和计算机的运行速度。

2. **简述文件控制块（FCB）的主要内容。**

   - 基本信息
     - 文件名：字符串，通常在不同系统中允许不同的最大长度，可修改
     - 物理位置
     - 文件逻辑结构：有/无结构（记录文件，流式文件）
     - 文件物理结构：（顺序、索引等）
   - 访问控制信息
     - 文件所有者（属主）：通常是创建文件的用户，或者改变已有文件的属主
     - 访问权限（控制各用户可使用的访问方式）：如读、写、执行、删除等
   - 使用信息
     - 创建时间
     - 上一次修改时间
     - 当前使用信息

3. **在I/O系统中引⼊缓冲的主要原因是什么？某⽂件占10个磁盘块，现要把该⽂件的磁盘块逐个读⼊主存缓冲区，并送⽤户区进⾏分析。⼀个缓冲区与磁盘块⼤⼩相等。把⼀个磁盘块读⼊缓冲区的时间为100μs，缓冲区数据传送到⽤户区的时间是50μs，CPU对⼀块数据进⾏分析的时间为50μs。分别计算在单缓冲区和双缓冲区结构下，分析完该⽂件的时间是多少？**

   1. 引入缓冲技术的原因：提高外设利用率，匹配CPU与外设的不同处理速度，减少对CPU的中断次数，提高CPU和I/O设备之间的并行性。

   2. 单缓冲结构下数据IO的过程示意如下，其中T代表读入缓冲区的时间，M代表缓冲区传送到用户区的时间，C代表CPU对数据分析的时间：

      ![在这里插入图片描述](https://img-blog.csdnimg.cn/2020060412231281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0plcmVteVpoYW8xOTk4,size_16,color_FFFFFF,t_70)

      由于读入时间T大于处理时间C，因此每一个磁盘块数据需要的时间为T+M=150μs，所有数据完成的时间为(T+M)*10+C=1550μs

   3. 双缓冲结构下数据IO的过程示意如下，其中T代表读入缓冲区的时间，M代表缓冲区传送到用户区的时间，C代表CPU对数据分析的时间：

      ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200604122323387.png)

      在CPU传输和处理一个缓冲区数据的过程中，IO设备可以向另一个缓冲区读入数据。由于M和C的时间之和恰好等于T，每一个数据块需要的时间只有T=100μs，所有数据完成的时间为T*10+M+C=1100μs

4. **分析磁盘访问数据的时间。假设磁盘请求以柱⾯10、35、20、70、2、3和38的词序进⼊磁盘驱动器。寻道时磁头每移动⼀个柱⾯需要6ms，以下各算法所需的寻道时间是多少：**

   **a) 先来先服务**

   **b) 最短寻道时间优先**

   **c) 扫描算法**

   **假设磁头初始位置为 15，⽅向向上(向⼤柱⾯号)。**

   1. 先来先服务，磁头移动的次序为：

      $15\rightarrow10\rightarrow35\rightarrow20\rightarrow70\rightarrow2\rightarrow3\rightarrow38$

      总时间：$(5+25+15+50+68+1+35)*6=1994$

   2. 最短寻道时间优先，磁头移动的次序为：

      1. 起始方向向上：$15\rightarrow20\rightarrow10\rightarrow3\rightarrow2\rightarrow35\rightarrow38\rightarrow70$

         总时间：$(5+10+7+1+33+3+32)*6=546$

      2. 起始方向向下：$15\rightarrow10\rightarrow3\rightarrow2\rightarrow20\rightarrow35\rightarrow38\rightarrow70$

         总时间：$(5+7+1+18+15+3+32)*6=486$

   3. 扫描算法，磁头移动的次序为：

      $15\rightarrow20\rightarrow35\rightarrow38\rightarrow70\rightarrow10\rightarrow3\rightarrow2$

      总时间：$(5+15+3+32+60+7+1)*6=738$

5. 

   1. 访问二级目录：根目录的目录项已经读入内存，那么读取二级目录不需要访问磁盘。

      访问三级目录：一个磁盘块1KB，每个目录项128B，那么一个磁盘块可以放1KB/128B=8个目录项；而如图所示每个二级目录下有128个三级目录，这些三级目录分布在128/8=16个磁盘块上。串联文件形式，访问一个三级目录项至少访问1次磁盘，至多访问16次磁盘，平均8.5次。

      访问文件块：文件平均大小100KB，每个磁盘块1KB，每个文件平均要分布在100KB/1KB=100个磁盘块上。串联文件形式，访问一个块至少访问1次磁盘，至多访问100次，平均50.5次。

      综上，平均共需要访问磁盘0+8.5+50.5=59次。

   2. 访问二级目录：访问二级目录的i节点1次，访问二级目录内容1次，共2次

      访问三级目录：访问三级目录的i节点1次。访问三级目录内容时，一个目录项只占14+2=16个字节，那么一个磁盘块可以存放1KB/16B=64个目录项，每个二级目录下有128个三级目录，分布在128/64=2个磁盘块上，因此访问三级目录的内容至少访问磁盘1次，至多访问磁盘2次，平均1.5次。因此访问三级目录平均访问磁盘2.5次。

      访问文件磁盘块：访问磁盘块的i节点1次，访问磁盘块1次，共2次。

      综上，平均共需要访问磁盘2+2.5+2=6.5次

   3. 文件系统最多允许记录的磁盘块数为16ZB/1KB=2^64个磁盘块。为表示这些磁盘块，需要64位，即8字节空间。inode中的索引区可以存放 512B/8B=64个磁盘块，一级索引指向的磁盘块中可存储1KB/8B=128个磁盘块号，在采用一级索引的情况下，支持的最大文件为64*128*1KB=8MB。
      

      

      