### T1

#### 1.

一共32字节

#### 2.

(0x11000000>>12)*4+0x11000000=0x11044000 



0x11000000+（0x11000000>>12)\*4+(0x11000000>>22)\*4 =0x11044110

#### 3.

二级页表地址转换

第一级页表物理地址 0x00200000



- 虚拟地址为 0x00001034，则 PDE：0x0 PTE：0x1 offset：0x34
- 获取 0x00200000+PDE*4的位置的值 即0x00200000的值 0x00100007
- 对于0x00100007 PTE为0x00100  Valid为 W:1 V:1
- 获取0x00100000+PTE*4的值 即 0x00100004的值 为0x00002067
- 对于0x00002067 物理页号为0x2 权限为Valid为 W：1 V：1
- 获取0x00002000+offset=0x00002034的值 为0x12 得到结果



- 虚拟地址为0x00C07665 PDE：0x003 PTE：0x7 offset：0x665
- 获取 0x00200000+PDE*4=0x0020000c的值 为0x00103007
- 对于0x00103007 PTE为0x103 Valid为V：1 W：1
- 获取0x00103+PTE*4=0x0010301C 的值为 0xEEFF0067
- 对于0xEEFF0067 物理页号为0xEEFF0  权限为Valid为W：1 V：1 可以store



- 虚拟地址为 0x00C005FF PDE：0x3 PTE: 0x0 offset:0x5ff
- 获取0x00200000+0x3*4=0x0020000C 值为0x00103007
- 对于0x00103007 PTE：0x00103 Valid：0x007 W：1 V：1
- 获取0x00103000+4*PTE=0x00103000 值为 0x11220005
- 对于0x11220005 物理页号为0x11220 Valid：0x005 V：1 W：0 不可写 所以ERROR



- 虚拟地址为 0x00C03012 PDE：0x3 PTE：0x3 offset：0x12
- 获取0x00200000+0xC=0x0020000C的值 0x00103007
- 对于0x00103007 PTE：0x00103 Valid：W：1 V：1
- 获取 0x00103000+0xC=0x0010300C的值0x7
- 对于0x7 PTE：0x00000 Valid：0x7 W：1 V：1
- 获取0x12的值 0x20



- 虚拟地址为0xFF80078F PDE：0x3FE PTE：0x0 offset：0x78F
- 获取0x00200000+4*0x3FE=0x00200ff8 值为 0x001FE007
- 对于0x001FE007 PTE：0x001FE 权限为Valid：W1 V1
- 获取0x001FE000的值0x04150000 权限为为V0 W0 error



- 虚拟地址为0xfffff00B PDE：0x3ff PTE：0x3FF offset:0x00B
- 获取0x00200000+4*0x3ff=0x00200ffc 的值为 0x001FF007
- 对于0x001FF007 PTE：0x001FF valid：0x7 可读可写
- 获取0x001FF+4*0x3ff=0x001FFFFC的值为0x00103067
- 对于0x00103067 物理页号0x00103 权限为0x67 可读可写
- 获取0x00103+0x00B=0x0010300B的值为0xCC

### T2

1.

OPT 最优置换算法

| 新来的页面 | 物理页1 | 物理页2 | 物理页3 | 操作                    |
| ---------- | ------- | ------- | ------- | ----------------------- |
| 5          | 5       |         |         | 缺页                    |
| 4          | 5       | 4       |         | 缺页                    |
| 3          | 5       | 4       | 3       | 缺页                    |
| 2          | 5       | 4       | 2       | 缺页，最晚出现3，2替换3 |
| 4          | 5       | 4       | 2       | 有                      |
| 5          | 5       | 4       | 2       | 有                      |
| 4          | 5       | 4       | 2       | 有                      |
| 1          | 5       | 1       | 2       | 缺页，最晚出现4，1替换4 |
| 5          | 5       | 1       | 2       | 有                      |
| 2          | 5       | 1       | 2       | 有                      |
| 5          | 5       | 1       | 2       | 有                      |
| 4          | 5       | 4       | 2       | 缺页，最晚出现1，4替换1 |
| 5          | 5       | 4       | 2       | 有                      |
| 2          | 5       | 4       | 2       | 有                      |
| 1          |         |         |         | 缺页，任意替换即可      |

FIFO

*代表这次替换的位置

| 新来的页面 | 物理页1 | 物理页2 | 物理页3 | 操作 |
| ---------- | ------- | ------- | ------- | ---- |
| 5          | 5*      |         |         | 缺页 |
| 4          | 5       | 4*      |         | 缺页 |
| 3          | 5       | 4       | 3*      | 缺页 |
| 2          | 2*      | 4       | 3       | 缺页 |
| 4          | 2       | 4       | 3       | 有   |
| 5          | 2       | 5*      | 3       | 缺页 |
| 4          | 2       | 5       | 4*      | 缺页 |
| 1          | 1*      | 5       | 4       | 缺页 |
| 5          | 1       | 5       | 4       | 有   |
| 2          | 1       | 2*      | 4       | 缺页 |
| 5          | 1       | 2       | 5*      | 缺页 |
| 4          | 4*      | 2       | 5       | 缺页 |
| 5          | 4       | 2       | 5       | 有   |
| 2          | 4       | 2       | 5       | 有   |
| 1          | 4       | 1*      | 5       | 缺页 |

LRU

*代表下次要被替换

| 新来的页面 | 物理页1 | 物理页2 | 物理页3 | 操作 |
| ---------- | ------- | ------- | ------- | ---- |
| 5          | 5       |         |         | 缺页 |
| 4          | 5*      | 4       |         | 缺页 |
| 3          | 5*      | 4       | 3       | 缺页 |
| 2          | 2       | 4*      | 3       | 缺页 |
| 4          | 2       | 4       | 3*      |      |
| 5          | 2*      | 4       | 5       | 缺页 |
| 4          | 2*      | 4       | 5       |      |
| 1          | 1       | 4       | 5*      | 缺页 |
| 5          | 1       | 4*      | 5       |      |
| 2          | 1*      | 2       | 5       | 缺页 |
| 5          | 1*      | 2       | 5       |      |
| 4          | 4       | 2*      | 5       | 缺页 |
| 5          | 4       | 2*      | 5       |      |
| 2          | 4*      | 2       | 5       | 缺页 |
| 1          | 1       | 2       | 5       |      |



### T3

FirstFit





BestFit

### T4

#### 1.

原序列： 2 6 10 20 22 38 40

扫描次序 20 22 38 40 50（边界） 10 6 2

总时间： 30\*4ms+48\*4ms=312ms

#### 2.

t+31ms时 磁头处于27-28柱面之间，请求访问50号柱面，此时请求队列为 10 2 40 6 38 50

t+70ms时 磁头处于37-38柱面之间，请求访问1好柱面，则最后访问1号，此时请求队列为 10 2 40 6 38 50 1

t+91ms时 磁头处于42-43柱面之间 请求访问10号柱面 此时请求队列为 10 2 40 6 38 50 1

最后总顺序为 20 22 38 40 50 10 6 2 1

总时间 30\*4ms+48*4ms=316ms

### T5

P

```c
semaphore empty=50;
semaphore a=0;
semaphore b=0;
semaphore mutex=1;
甲{
	while(1){
        produce(A);
        P(empty);
        P(mutex);
        put(A);
        V(mutex);
        V(a);
    }
}
乙{
	while(1){
        produce(B);
        P(empty);
        P(mutex);
        put(B);
        V(mutex);
        V(b);
    }
}
需要A的客户{
    while(1){
        P(a);
        P(mutex);
        get(A);
        V(mutex);
        P(empty);
    }
}
    
需要B的客户{
    while(1){
        P(b);
        P(mutex);
        get(B);
        V(mutex);
        V(empty);
    }
}
```

### T6

```c
互斥量 一旦开始上车 新来的乘客等下一辆
同步 车来了等待的乘客才可以上车
互斥 超过50人时要等下一辆，此时不能进入等待队列
semaphore mutex=0;//车是否来了
semaphore wait=50;//等车队列
semaphore mutex=1;//当前是否为空
乘客{
	while(1){
        P(wait);
    	
    }
}
巴士{
    
}
```

### T7

#### 1.

先把当前资源分配给P4，随后P4释放现有资源此时

可用资源 0 5 5 2

随后分配给P1，然后P1释放现有资源，此时

可用资源 0 6 7 2

此时可分配给P5，随后P5释放资源，然后

可用资源 0 6 8 6

然后P2和P3的需求均无法满足，发生死锁。

#### 2.

在1的基础上，若首先满足P2的需求，则需要提供2个R2，代价为2，随后P2释放资源，此时

可用资源 1 8 8 6

随后可以满足P3的需求，解除了死锁



若首先满足P3的需求，则需提供1个R1，代价为1，随后P3释放资源

当前可用资源 2 9 13 10

可以满足P2的需求，解除了死锁

综上 增加一个R1资源便可以用最小代价避免系统发生死锁。

### T8

#### 1.

2KB\*10+1\*(2KB/4B)\*2KB+1\*(2KB/4B)\*(2KB/4B)\*2KB=20KB+1024KB+512\*512\*2=525332KB

#### 2.

令总文件数为x

则利用率为$\frac{x/2*2+x/2*1.5}{x*2}$=87.5%

若数据块大小改为1KB，利用率不变



## 21年试卷

### T6

|     时刻     | FCFS | SRTF |  RR  | Priority |
| :----------: | :--: | :--: | :--: | :------: |
|      0       |  A   |  A   |  A   |    A     |
|      1       |  A   |  B   |  B   |    A     |
|      2       |  A   |  A   |  A   |    A     |
|      3       |  B   |  A   |  C   |    C     |
|      4       |  C   |  C   |  A   |    C     |
|      5       |  C   |  C   |  C   |    C     |
|      6       |  C   |  D   |  D   |    D     |
|      7       |  C   |  D   |  C   |    D     |
|      8       |  C   |  E   |  E   |    C     |
|      9       |  D   |  E   |  D   |    C     |
|      10      |  D   |  C   |  C   |    B     |
|      11      |  E   |  C   |  E   |    E     |
|      12      |  E   |  C   |  C   |    E     |
| 平均等待时间 |      |      |      |          |

